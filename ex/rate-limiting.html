<!DOCTYPE html><html><head><title>Haskell by Example: Rate Limiting</title><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../css/prism.css"><script src="../js/prism.js"></script></head><body><div class="example"><h1>Haskell by Example: Rate Limiting</h1><a href="https://gobyexample.com/rate-limiting">original</a><pre><code class="language-haskell">import Data.Time
import Control.Concurrent
import Control.Monad

main = do
    requests &lt;- newChan
    mapM_ (writeChan requests) [1..5]

    limitter &lt;- newChan
    forkIO . forever $ do
        writeChan limitter ()
        threadDelay (200 * 1000)

    forM_ [1..5] $ \req -&gt; do
        readChan limitter
        now &lt;- getCurrentTime
        putStrLn $ &quot;request &quot; ++ show req ++ &quot; &quot; ++ show now

    burstyLimitter &lt;- newChan
    now &lt;- getCurrentTime
    forM_ [0..2] $ \_ -&gt; do
        writeChan burstyLimitter now

    forkIO . forever $ do
        now &lt;- getCurrentTime
        writeChan burstyLimitter now
        threadDelay (200 * 1000)

    forM_ [1..5] $ \req -&gt; do
        readChan burstyLimitter
        now &lt;- getCurrentTime
        putStrLn $ &quot;request &quot; ++ show req ++ &quot; &quot; ++ show now
</code></pre>
<pre><code class="language-bash">$ runhaskell rate-limiting.hs
request 1 2015-05-05 12:44:43.840436 UTC
request 2 2015-05-05 12:44:44.04126 UTC
request 3 2015-05-05 12:44:44.246552 UTC
request 4 2015-05-05 12:44:44.451247 UTC
request 5 2015-05-05 12:44:44.654298 UTC
request 1 2015-05-05 12:44:44.654908 UTC
request 2 2015-05-05 12:44:44.655353 UTC
request 3 2015-05-05 12:44:44.655698 UTC
request 4 2015-05-05 12:44:44.656051 UTC
request 5 2015-05-05 12:44:44.86019 UTC
</code></pre><a href="../">back to index</a></div></body></html>